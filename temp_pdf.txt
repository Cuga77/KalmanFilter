  МИНИСТЕРСТВО ОБРАЗОВАНИЯ И НАУКИ РОССИЙСКОЙ ФЕДЕРАЦИИ
         Федеральное агентство по образованию
            Государственное образовательное учреждение
              высшего профессионального образования
           Московский физико-технический институт
               (государственный университет)



               Кафедра теоретической механики




ИСПОЛЬЗОВАНИЕ ФИЛЬТРА КАЛМАНА В ЗАДАЧЕ
     ОПРЕДЕЛЕНИЯ ОРИЕНТАЦИИ ТЕЛА,
       ПОДВЕШЕННОГО НА СТРУНЕ



        Руководство по лабораторной работе




Составители: Д.С.Иванов, М.Ю.Овчинников, С.С.Ткачев




                       МОСКВА 2008
УДК 629.78, 531.38

        Использование фильтра Калмана в задаче определения
ориентации тела, подвешенного на струне: Руководство по лаборатор-
ной работе / Сост.: Д.С. Иванов, М.Ю. Овчинников, С.С. Ткачев — М.:
МФТИ, 2008. — 29 с.



В рамках Инновационной Образовательной Программы «Наукоемкие
технологии и экономика инноваций» создается учебный процесс, основ-
ными целями которого являются развитие у студентов системного под-
хода к решению задач исследования движения сложных информаци-
онно-механических систем и повышение эффективности учебного
процесса при изучении различных разделов теоретической механики и
прикладной математики. В Руководстве изложены элементы теории
адаптивного расширенного фильтра Калмана. На примере тела, под-
вешенного на струне, демонстрируется применение фильтра Калмана в
задаче определения ориентации по измерениям гироскопа. Приведены
методики проведения измерений и обработки полученных данных.




                                             УДК 531.38: 629.78




                         © Московский физико-технический институт
                               (государственный университет), 2008




                               2
Содержание
Введение                                                   4
1. Фильтр Калмана                                          5
    1.1 Линейная задача. Основные понятия                  5
    1.2 Коэффициент обратной связи                         7
    1.3 Коррекция значения ковариационной матрицы ошибки   8
    1.4 Фильтр Калмана для нелинейных систем               9
    1.5 Использование фильтра Калмана                      10
    1.6 Адаптивный фильтр. Метод “Уточнение ковариации”    11
2. Применение фильтра Калмана                              13
    2.1 Перманентное вращение                              13
    2.2 Крутильные колебания                               14
3. Макет                                                   17
    3.1 Схема макета                                       17
    3.2 Волоконно-оптический гироскоп VG-910D              18
    3.3 Интегральный гироскоп на базе iMEMS технологии     19
4. Программное обеспечение макета                          20
    4.1 Работа программы                                   21
    4.2 Интерфейс                                          22
    4.3 Управление ПО                                      23
5. Порядок выполнения лабораторной работы                  24
6. Контрольные вопросы                                     27
7. Приложение                                              28
8. Литература                                              30




                              3
Введение
       Задача определения ориентации тела заключается в нахождении
кватерниона или матрицы перехода из неподвижной системы координат
в систему координат, жестко связанную с телом. В настоящей лабора-
торной работе рассмотрим достаточно простую механическую систему –
подвешенное на струне тело вращается вокруг вертикальной оси, други-
ми движениями тела пренебрегаем. Задача определения ориентации
такого тела – это задача нахождения угла поворота системы координат,
жестко связанной с телом, относительно некоторой неподвижной си-
стемы координат. Решать эту задачу будем при условии, что известна
угловая скорость вращения тела, которую с известной частотой выдаёт
датчик угловой скорости. Решить такую задачу можно просто интегри-
рованием кинематического уравнения             , но реальные датчики
угловой скорости выдают значение скорости с некоторой ошибкой.
Таким образом, при интегрировании кинематического уравнения доста-
точно быстро накапливается ошибка определения ориентации.
       В зависимости от предположений относительно характера и
свойств помех предлагаются те или иные способы решения этой про-
блемы. Например, метод наименьших квадратов, который представляет
собой фактически усреднение данных наблюдения, но при динамиче-
ской оценке состояния системы он не очень удобен, так как требует
накопление и обработки всех предыдущих измерений. Поэтому в этой
лабораторной работе подробно будет рассмотрен фильтр Калмана – по-
следовательный рекурсивный алгоритм оценки, использующий приня-
тую модель динамической системы для получения оценки состояния си-
стемы.
       При выполнении настоящей лабораторной работы преследуются
следующие цели:
        на примере тела, подвешенного на струне, получить навыки ра-
боты с фильтром Калмана;
       провести сравнительный анализ двух фильтров Калмана, осно-
ванных на разных моделях движения;
       ознакомиться с принципом работы современных датчиков
угловой скорости;
       получить навыки работы в среде Matlab.




                                4
                      1. Фильтр Калмана
        Фильтр Калмана – последовательный рекурсивный алгоритм, ис-
пользующий принятую модель динамической системы для получения
оценки, которая может быть существенно скорректирована в результате
анализа каждой новой выборки измерений во временной последователь-
ности. Этот алгоритм находит применение в процессе управления
многими сложными динамическими системами, например, непрерыв-
ными производственными процессами, самолетами, кораблями и косми-
ческими аппаратами. При управлении динамической системой, прежде
всего, необходимо полностью знать её фазовое состояние в каждый мо-
мент времени. Но измерение всех переменных, которыми необходимо
управлять, не всегда возможно, и в этих случаях фильтр Калмана явля-
ется тем средством, которое позволяет восстановить недостающую
информацию посредством имеющихся неточных (зашумленных) изме-
рений.

        1.1 Линейная задача. Основные понятия
        Предполагаем, что стохастическая система может быть описана
моделями динамики и измерений (для непрерывного и дискретного слу-
чаев), представленными в Табл. 1.
                                                            Табл. 1
 Модель        Непрерывное время           Дискретное время
Система
Измерения
Шум
системы
Шум
измерений

Здесь      вектор состояния динамической системы, который является
случайным Гауссовским процессом,     - измерения, полученные в мо-
мент времени . Шум системы и шум измерений          и     также яв-
ляются Гауссовскими случайными процессами с нулевым математиче-
ским ожиданием. Другими словами мы предполагаем наличие в системе
и измерениях белого шума.
       Задача фильтрации состоит в том, чтобы найти оценку вектора
состояния системы      , которую мы будем обозначать    , являющу-
                                5
             юся функцией измерений      …     и которая минимизирует средне квад-
             ратичную ошибку
                                                                  ,
tk1   tzk




             где M – симметричная положительно-определенная матрица.




                              Прогноз                 Коррекция


                   xˆ k  1 ()           xˆ k ( )                   xˆ k ()
                                                                                 t

                    Фильтр Калмана работает по системе прогноз-коррекция. Допу-
             стим, что в момент времени     получена оценка вектора состояния си-
             стемы        и теперь необходимо получить оценку в момент      . Для
             этого строим прогноз оценки        , базируясь на   , получаем изме-
             рения      и далее корректируем оценку в момент       , базируясь на
             прогнозе и измерениях, и получаем окончательную оценку вектора
             состояния        .       называется априори оценка,       называется
             апостериори оценка.
                    Рис. 1 Принцип работы фильтра Калмана

                    Второй момент случайного процесса может быть описан в терми-
             нах ковариационной матрицы
                                                                      ,          (1)


                                               6
 Матрица P(t) называется ковариационной матрицей ошибки оценки век-
 тора состояния (далее – ковариационная матрица ошибки).
         Очевидно, что для получения прогнозируемой оценки           не-
обходимо      интегрировать    модельное      динамическое     уравнение
                с начальным условием                  . А каким образом
мы можем получить прогнозируемую оценку ковариационной матрицы
ошибки? Для того чтобы ответить на этот вопрос рассмотрим непрерыв-
ную модель системы
                                                ,
описанную в Табл 1. Решение этого уравнения с начальным условием
x(t0) и переходной матрицей состояния Ф(t, t0) записывается в виде

                                                      .

Математическое ожидание этой величины –

                                                          .

Тогда

                                                                . (2)

Подставляя (2) в выражение (1), производя некоторые преобразования и
вычисляя первую производную функции P(t), в результате получим
                                                .             (3)
Это матричное дифференциальное уравнение Риккати [1].
      Итак, получили уравнение продолжения ковариационной матри-
цы ошибки. Путем интегрирования уравнения (3) с начальным условием
              получим прогнозируемую оценку ковариационной матри-
цы ошибки         .

       1.2 Коэффициент обратной связи
       Предположим, что измерения были сделаны в момент времени
и эта информация используется для оценки вектора состояния х сто-
хастической системы в момент времени .
       Предполагается также, что измерения линейно зависят от вектора
состояния и описываются уравнением

                                  7
                                        .                   (4)
      Оценка         базируется на наблюдениях (или измерениях)   .
Таким образом, она является функцией априори оценки       и измере-
нии    и может быть записана в следующем виде:
                                                 .                   (5)
       Матрицы      и     пока неизвестны и их значения будут опреде-
ляться таким образом, чтобы новая оценка      удовлетворяли принци-
пу ортогональности, условия которого могут быть записаны в виде
                                                                 ,   (6)
                                                     .
        Подставляя в уравнение (6) значения     и        из выражений
(1) и (5) и учитывая тот факт, что случайные последовательности     и
     некоррелированы, после некоторых преобразований [1], выражаем
коэффициент обратной связи в следующем виде:
                                           ,                   (7)
                                                             .       (8)
Этот коэффициент является функцией от априори значения ковариаци-
онной матрицы ошибки.

      1.3 Коррекция значения ковариационной матрицы ошибки
оценки вектора состояния
      Теперь выведем формулу для апостериори значения ковариаци-
онной матрицы ошибки (для корректировки ковариационной матрицы
ошибки). По определению она записывается в виде
                                             ,                       (9)
где
                                    ,                        .       (10)
Подставляя (7) в (5), получим
                                                         .           (11)
Вычтем     из обеих частей выражения (11) и подставим в него значение
   в соответствии с (4). В результате получим

                                8
или с учетом (10)
                                                  .           (12)
Подставляя уравнение (12) в уравнение (9) и принимая во внимание, что
                 получим
                                              .               (13)

       1.4 Фильтр Калмана для нелинейных систем (расширенный
фильтр)
       Большинство динамических систем и сенсоров не являются ли-
нейными. Но методы фильтрации, разработанные для линейных систем,
могут быть применены и для нелинейных систем. В этом разделе
рассматриваются методы, которые позволят перенести методологию
фильтрации Калмана на нелинейные задачи.
        Предположим, что непрерывная или дискретная стохастическая
система может быть представлена нелинейным динамическим уравне-
нием и модельным уравнением, описывающим измерения (Табл. 2).

      Табл. 2. Нелинейные модели динамики и измерений
      Модель        Непрерывное время      Дискретное время
      Система
      Измерения


      Применяемый метод линеаризации требует, чтобы функции f и h
были дважды непрерывно дифференцируемые.
      Обозначим символом малое отклонение от оцениваемой траек-
тории

                                              .
Тогда               в окрестности          может быть представлена в
виде
                                                          .
Таким образом, получаем
                                              ,
где
                                    9
                                                         .      (14)
      В свою очередь, измерения могут быть представлены в виде раз-
ложения в ряд Тейлора в окрестности         следующим образом:



и
                                                 .
Слагаемые выше первого порядка малости здесь опущены. Если в раз-
ложении мы пренебрегаем членами высокого порядка, то возмущение
может быть представлено так
                                          ,
где
                                                 .              (15)
      В случае непрерывной системы матрицы частных производных
имеют следующий вид

                                                 ,              (16)


                                                     .          (17)


        1.5 Использование фильтра Калмана
        Подведем некоторый итог всего вышеизложенного на примере не-
прерывно-дискретной системы (непрерывная динамическая система с
дискретными измерениями), которая и описывает большинство реальных
задач. Такая система записывается следующим образом:
                                                    ,
                                                 .
        Допустим, что в момент времени tk-1(+) получены апостериори
значения          и       , то есть на шаге tk-1(+) задача фильтрации вы-
полнена и теперь необходимо определить             и      .


                                  10
   Априори значения оценок вектора состояния и ковариационной мат-
рицы ошибки          и        можно получить путем интегрирования
модельного уравнения и уравнения типа Риккати
                                           ,


с начальными условиями              и            . Так как рассмат-
риваем нелинейную задачу, то для определения матриц
воспользуемся уравнением (16). Выполнив данную процедуру, получим
       и      .
       Далее, находим линеаризованную матрицу чувствительности
          согласно уравнению (15).
        Определяем коэффициент обратной связи      , используя уравне-
ние (8).
        Находим апостериори значения      и         по формулам (11)
и (13).

        1.6 Проблема адаптивного фильтра. Метод “Уточнение кова-
риации”
        Одной из основных проблем, с которой сталкиваются при работе с
фильтром Калмана, является то, что как модель самой системы, так и
модель измерений неидеальны. Статистические свойства шумов, а имен-
но, их ковариационные матрицы являются теми параметрами, от которых
зависит точность оценивания вектора состояния системы, то есть точ-
ность работы фильтра.
        Обычно начальные значения ковариационных матриц шума изме-
рений и шума процесса выбираются путём анализа некоторых эмпириче-
ских данных или путём моделирования различных ситуаций и далее
считается постоянной. Если в процессе использования этих данных выяс-
няется, что работа фильтра неудовлетворительна, то требуется новая на-
стройка ковариационных матриц шумов. Появляется задача адаптивной
фильтрации – параллельно с оценкой вектора состояния системы оце-
нивать статистические свойства шумов процесса и измерений (ковари-
ационные матрицы) с целью повышения точности работы фильтра. Один
из методов такой оценки – метод “Уточнение ковариации”.
        Этот подход базируется на идее, что ковариационная матрица
шума процесса равна ковариационной матрице ошибки измерения, то
есть
                                 11
                                                     .
       Введём величину, называемую прогнозируемая разность ошибки
измерения
                                             .
       Для придания алгоритму большей статистической значимости бу-
дем рассматривать выборку из N, сечение случайного процесса

                                             .

       Аналогичный подход можно использовать для оценки ковариаци-
онной матрицы шума системы. Исходя из здравого смысла, его можно
аппроксимировать с помощью оценок вектора состояния , полученных
на двух последовательных шагах
                                          .
       Оценку ковариационной матрицы шума процесса можно записать
с использованием N-выборочного среднего в виде

                                         .

       Общую схему для оценки ковариационной матрицы шума процес-
са и шума измерений можно представить в виде табл. 3.

    Табл. 3 Уточнение ковариации для оценки R и Q
       Действия             Оценка R                     Оценка Q
 1 Начальные условия j=1,                    j=1,
 2 Аппроксимация
   шума
 3 Вычисление


 4 j=N                    Подставляем          в Подставляем            в
                          фильтр                 фильтр
 5 j<N                     Увеличиваем j на 1 и переходим к шагу 2


               2. Применение фильтра Калмана
       Теперь используем фильтр Калмана применительно к нашей зада-
че определения ориентации тела, подвешенного на струне, учитывая, что
                                12
имеются дискретные измерения угловой скорости, поступающие от дат-
чика. Рассмотрим две модели.

       2.1 Перманентное вращение
      В первой модели предполагается, что тело на струне вращается с
постоянной скоростью. Понятно, что на самом деле тело меняет скорость
своего вращения вследствие сил упругости струны, но, как показывает
практика, если струна достаточно длинная, такая модель неплохо описы-
вает движение системы на небольших промежутках времени. Кроме того,
фильтр, основанный на этой модели, демонстрирует насколько “страдает”
оценка состояния системы, если выбрана достаточно грубая динамиче-
ская модель. Итак, движение описывается уравнением
                                      .
Вектор состояния и динамическое уравнение в нашем случае

                            ,                       .

Уравнение можно записать по другому:

                                          .                     (18)

Модель измерений при наличии датчика угловой скорости выглядит
следующим образом:

                                                            .

Проинтегрируем уравнение (18), получим:

                                , где                   .

Пусть ковариационная матрица ошибки       имеет следующие элементы:

                                          .
Тогда матричное уравнение Риккати (3) с начальными условиями

              имеет следующее решение:




                                13
                              , где                        .


Коэффициент обратной связи, согласно (8)


                                           .


Тогда апостериори оценка вектора состояния и матрицы ковариации из
(11) и (13) соответственно имеют вид


                                                   ,




                                                       .


      Таким образом, получили все формулы, необходимые для работы
фильтра Калмана, основанного на модели перманентного вращения.

       2.2 Крутильные колебания
       Во второй модели предполагаем, что тело совершает малые одно-
мерные крутильные колебания относительно вертикальной оси. Здесь ис-
пользуется [2] тот факт, что при малом погонном угле закрутки механи-
ческий момент, действующий со стороны струны, пропорционален углу
отклонения от положения равновесия

                                               ,

где R – радиус упругой струны, l – её длина, G – модуль сдвига, f –
модуль кручения. Погонный угол закрутки α определяется выражением
                                    =2πk/l,                 (19)
где k - число оборотов нити, l - ее длина.

                                14
       Таким образом, уравнение движения системы выглядит следу-
ющим образом [3]:
                                        .                  (20)
Здесь I – момент инерции тела относительно оси вращения, - угол по-
ворота тела относительно положения равновесия. Обозначим

                                      .

Вектор состояния и динамическое уравнение в этом случае имеют вид

                          ,

или

                                           .                  (21)

Модель измерения

                                                      .

Проинтегрируем уравнение (21):

                                                  ,



                                                  .


Матричное уравнение Риккати (3) с начальными условиями

              имеет решение




                                                          ,



                                 15
                                                        .



Коэффициент обратной связи согласно (8)




Тогда апостериори оценка вектора состояния и матрицы ковариации из
(11) и (13)


                                              ,             (22)




                                                  .




                               16
                                     3. Макет
       3.1 Схема макета
       Макет представляет собой автономный прибор, включающий в
себя систему электропитания, систему определения ориентации и си-
стему связи. Схема макета изображена на рис.2, сам макет – на рис.3.
       Система электропитания включает в себя два аккумулятора и
преобразователь напряжения. Преобразователь из 17 вольт от аккумуля-
торов формирует 5 вольт, необходимых для питания бортового компью-
тера и микромеханического гироскопа iMEMS ADIS16100.

                                     ADIS16100
 Стац.           VG-910D
 компьютер                                                5V Преобразователь
                                                             напряжения
                           USB-Hub
                                                                   17V
                                          Бортовой    +
                                          компьютер
                Wi-Fi
                                                      –      +     –
    Wi-Fi
                                                            Аккумулятор

       Рис.2. Схема макета

       Система опре-
деления ориентации со-
стоит из бортового
компьютера JRex CE
(далее БК), оптово-
локонного гироскопа
VG-910D и микромеха-
нического гироскопа
iMEMS ADIS16100. БK
производит считывание
информации           об
угловой скорости с од-
ного из гироскопов, об-              Рис.3. Макет
рабатывает её с помо-
щью программного обеспечения (далее ПО) в режиме реального време-

                                     17
ни и сохраняет результаты в файл. Передача информации производится
через USB порты БК, используется разветвитель USB-Hub.
       Система связи состоит из устройства Wi-Fi и БК. Устройство Wi-
Fi позволяет организовать доступ к БК через удалённый рабочий стол.
Управление ПО происходит со стационарного компьютера через удалён-
ный рабочий стол БК.
       Остановимся подробнее на датчиках угловой скорости.

       3.2 Волоконно-оптический гироскоп VG-910D
       VG-910D – это одноосный прецизионный датчик вращения, вы-
полненный по волоконно-оптической технологии, производства компа-
нии ФИЗОПТИКА [4]. Его функционирование основано на реляти-
вистском эффекте Саньяка. Датчик содержит волоконно-оптический




       Рис.4. Схема датчика VG-910D
преобразователь и блок электроники, реализующий современные алго-
ритмы обработки аналоговых сигналов.
       VG-910D предназначен для использования в различных областях
техники с целью измерения угловой скорости вращения. Выходной циф-
ровой сигнал пропорционален угловой скорости с некоторым масштаб-
ным коэффициентом. Диапазон измерений         град/сек, цифровой вы-
ход угловой скорости – 24-х разрядное число в дополнительном коде,
входное напряжение – 5V, прибор может питаться через USB кабель.
Датчик весит 130 грамм при габаритах 80мм 19мм. Частота выходных
данных – 300Гц.
       VG-910D состоит из двух основных узлов (рис. 4):
        волоконно-оптический преобразователь – кольцевой ин-
           терферометр, содержащий волоконный контур (катушка),
           сварные волоконно-оптические ответвители, волоконно-кри-
                                 18
           сталлический поляризатор, пьезокерамический модулятор и
           светодиодный излучательный модуль;
        плата обрабатывающей электроники с аналого-цифровым
           преобразователем.
       Принцип действия датчика основан на зависимости времени рас-
пространения света по замкнутому вращающемуся контуру от направ-
ления обхода. В интерферометре излучение делится на два луча равной
интенсивности, которые распространяются в контуре в противополож-
ных направлениях, а затем смешиваются и интерферируют. При враще-
нии между волнами возникает разность фаз (фаза Саньяка), которая и
является мерой угловой скорости. Коэффициент пропорциональности
между угловой скоростью и фазой Саньяка называется оптическим
масштабным коэффициентом преобразователя. Его величина определяет
диапазон измеряемых угловых скоростей.

        3.3 Интегральный гироскоп на базе iMEMS-технологии
        ADIS16100 – интегральный гироскоп на базе технологии iMEMS
(integrated Micro Electro Mechanical System), устройство фирмы Analog
Devices, интегрирующее на одном кремниевом кристалле датчик
угловой скорости и электронику, обеспечивающую формирование и
предварительную обработку сигнала [5].
        Несмотря на меньшую в сравнении с прочими гироскопами точ-
ность, микромеханические гироскопы iMEMS обладают целым рядом
уникальных достоинств. Прежде всего – это малые габариты и масса.
Датчик угловой скорости ADIS16100 выпускается в миниатюрном
корпусе размером 7 7 3мм, вес такого прибора не превышает 0,5 г.
Диапазон измерения датчика         град/c, цифровой выход угловой ско-
рости – 12-ти разрядное число. Частота выходных данных – 1400Гц.
        Две микромеханические структуры из поликристаллического
кремния снабжены специальными возбуждающими рамками, которые с
помощью электрического сигнала приводятся в резонанс. Колебания
микромеханических элементов имеют достаточно высокую частоту и
амплитуду, чтобы при угловом вращении прибора сила Кориолиса, дей-
ствующая на эти элементы, достигла заметной величины. По краям каж-
дой колеблющейся рамки, перпендикулярно направлению колебаний,
расположены подвижные зубцы, которые чередуются с неподвижными
зубцами; таким образом, образуется структура, емкость которой меняет-
ся в соответствии с величиной силы Кориолиса. Полученный с емкост-
ного датчика высокочастотный сигнал поступает на каскады усиления и

                                 19
демодуляции, в итоге на выходе микросхемы получаем сигнал, напряже-
ние которого пропорционально угловой скорости.
       Следует отметить некоторые недостатки датчиков угловой ско-
рости. Кроме основного недостатка – шум выдаваемых измерений – су-
ществует такая проблема как “уход” датчика – накапливаемая ошибка, к
примеру, при интегрировании угловой скорости. Это связано с зави-
симостью положения “нуля” (значения угловой скорости в состоянии
покоя) от температуры и с тем, что у реальных датчиков математическое
ожидание шума измерений несколько отличается от нуля. Кроме того,
существует слабая зависимость калибровочных коэффициентов от
температуры, что приводит к неточности измерений в условиях ме-
няющейся температуры. Все эти недостатки ведут к тому, что на боль-
ших промежутках времени, основываясь только на информации с дат-
чиков угловой скорости, можно получить неудовлетворительную оценку
вектора состояния. Поэтому показания датчиков угловой скорости часто
уточняют, используя, к примеру, данные с позиционных датчиков.
Другое решение описанных проблем – используя температурный дат-
чик, построить калибровочную базу данных, откуда при различных
температурах брать различные калибровочные коэффициенты и значе-
ния смещения “нуля” датчика. Но, так как в настоящей лабораторной ра-
боте датчики угловой скорости используются на небольших промежут-
ках времени, то описанные недостатки не будут проявляться в достаточ-
ной мере.




                4. Программное обеспечение макета
   Программное обеспечение (ПО) – это программа, работающая на БК
макета, осуществляющая считывание информации с датчика угловой
скорости, её обработку и сохранение результатов вычислений в файл.
Программа написана в среде C++ Builder 6.
      4.1 Работа программы




                                20
        С датчика по-
ступает       цифровой
сигнал,        который
умножением на некото-
рый коэффициент и
смещением (калибров-
ка) преобразуется в
угловую        скорость
(Рис.5).      Значения
угловой скорости за
несколько измерений
суммируются,      после
чего эта сумма делится
на количество измере-
ний, таким образом, на    Рис.5. Схема работы программы
выходе        получаем
усреднённое значение угловой скорости. Усреднение производится для
того, чтобы уменьшить шум измерений и уменьшить число вычислений
программы в единицу времени. У программы есть верхний предел по ча-
стоте выходных данных       100Гц, выше этого значения программа не
успевает обрабатывать поступающие с датчика данные, обработка в
режиме реального времени становится невозможной. И поэтому при
установке параметров работы программы нужно отдельно обратить
внимание на усреднение: зная частоту подачи данных устанавливать
такое усреднение (то есть выбрать количество измерений для усредне-
ния), чтобы частота выходных данных программы не превышала преде-
ла.
        Усреднённая угловая скорость поступает на вход сразу трём
программным модулям: интегрирование кинематического уравнения,
Фильтр Калмана (ФК) модели перманентного вращения, ФК модели
крутильных колебаний. На выходе соответственно имеем: результат ин-
тегрирования, апостериори оценки угла отклонения макета от положе-
ния равновесия и угловой скорости двух ФК. Все эти значения плюс
сама усреднённая угловая скорость подаются на вход модуля программы
“Уточнение ковариации”, который работает по алгоритму, описанному в
Табл.3. Он с некоторым периодом подставляет в фильтры Калмана
оценённое значение матрицы шума системы Q. Все выходные значения
программы записываются в файл с названием “xxxxxResults.txt” именно
в том порядке, как изображено на Рис.5. “xxxxx” в названии файла – это
случайное число, используемое здесь для того, чтобы не допустить пере-
                                  21
писывания файла с результатами предыдущего эксперимента. Каждый
блок выходных значений записывается в отдельной строке. В конце каж-
дого блока выходной информации записывается время с начала работы
программы.
       4.2 Интерфейс программы
       -
       Главное окно программы содержит две области (Рис.6):
      Port settings – установка рабочего датчика, выбор порта, через который бу
      Some information – содержит информацию о частоте входных значений с д




          Рис.6. Интерфейс ПО
       Главное окно содержит меню со следующими разделами:
           File – выход из программы.
           Sensor calibration – установка калибровочных коэффициен-
тов для датчиков VG-910D и ADIS16100.
           Initial conditions – задание начального вектора состояния ма-
кета.
           Dynamic model – задание периода крутильных колебаний.
           Model of measuring – задание параметров модели измерений
(квадрата ошибки измерений          и значений элементов матрицы ошибки
для ФК) и размера выборки N для алгоритма “Уточнение ковариации”.
           Graphics – вывод в режиме реального времени графиков
угловой скорости и угла отклонения от положения равновесия. Графики
отображают все выходные данные программы.
           Output values – вывод на экран выходных значений 2-х
фильтров и результата интегрирования.
       4.3 Управление ПО

                                  22
       Управление ПО осуществляется при помощи интерфейса
программы (Рис.6). Перед запуском программы необходимо произвести
следующие действия:
       1. В области Port settings в выпадающем окошке Choose sensor
выбрать датчик, с которого будет производиться чтение (VG-9, во-
локонно-оптический датчик или Mems, микромеханический датчик)
       2. В окошке Number of port задать COM-порт, откуда будет
считываться информация (для VG-9 – СOM1, для Mems – COM2).
       3. Установить значение усреднения Averaging.
       4. В разделе меню Initial conditions задать начальный угол
отклонения от положения равновесия в градусах (если макет закручен
по часовой стрелке, то добавляется знак минус).
       5. В разделе меню Model of measuring установить значение квад-
рата ошибки      для заданного усреднения датчика и размер выборки N
для алгоритма “Уточнение ковариации”. Если N=0, то “Уточнение кова-
риации” отключено.
       6. В разделе меню Dynamic model задать период крутильных ко-
лебаний.
       7. Запустить программу, нажав на кнопку Open port. ПО начнет
производить вычисления.
       Результаты вычислений отображаются на графиках раздела меню
Graphics.




                                23
       5. Порядок выполнения лабораторной работы
      1. Проверить, что аккумуляторы надежно соединены проводами с
платой питания. Проверить правильность подключения аккумуляторов:
черный провод всегда соответствует минусу, поэтому он должен соеди-
няться с черным проводом аккумулятора и входить в разъем платы с
подписью “–”; провода с любым другим цветом (кроме белого, который
тоже иногда соответствует “–”) обозначают полярность “+” и должны
подключаться соответственно.
      2. Включить БК. Проверить, что на макете зажглась желтая
лампочка –индикатор включения питания.
      3. Включить стационарный компьютер. После загрузки, нажать ле-
вой кнопкой мыши два раза по значку Wi-Fi           , в открывшемся
диалоговом окне нажать на кнопку Обновить. В списке Беспроводные
сети должна появиться сеть Gyro, её необходимо выделить и нажать
кнопку Подключить. Далее зайти Пуск-> Программы->Стандартные-
>Связь->Подключение к удалённому рабочему столу. В появившемся
окне необходимо набрать адрес макета \\10.10.10.4 и нажать кнопку
Подключить. При подключении к удалённому рабочему столу БК маке-
та необходимо будет ввести User Name - Administrator и Password – “1”.
      4. Запустить программу “Gyro”, ярлык которой находится на рабо-
чем столе БК. В окошке “Choose sensor” выбрать “VG-9”, указав тем
самым, что считывание будет производиться с оптоволоконного датчика
угловой скорости, выбрать “COM1” в окошке “Number of port”,
установить усреднение – 10. Нажать “Open port”. В левом нижнем углу
окна должна появиться надпись File open successfully. Зайти в меню
“Graphics” и выбрать “Graph of Rate of Rotation”. График будет отоб-
ражать текущее значение выдаваемой датчиком угловой скорости и
оценки угловой скорости фильтров Калмана. Если график ничего не
отображает или застыл (не показывает текущих значений), нажать кноп-
ку “Close port”, установить большее усреднение и вновь запустить
программу. Так как макет находится в неподвижном состоянии (лежит
на столе), то показания датчика будут колебаться около нуля (белый
шум). По отклонениям от нуля оценить квадрат среднеквадратичной
ошибки -      . Для этого отметить на графике наибольшее             и
наименьшее         зачение, найти разницу между ними, поделить на два

и возвести в квадрат, то есть                   . Запишите результат.

                                 24
      5. Нажать кнопку “Close port”. В окошке “Choose sensor” выбрать
“Mems”, “Number of port” – “COM2”. Рассчитать минимальное усредне-
ние для “Mems”, учитывая максимальную частоту выходных данных ПО
(см. пункт 4.1 Руководства) и зная, что выходная частота данных для
этого датчика составляет 1400Гц. Установить усреднение. Запустить
программу. Оценить аналогичным образом         (пункт 4) для микромеха-
нического гироскопа. Записать результат.
      6. Выключить БК, нажав комбинацию клавиш Alt+F4 и выбрав
Shut down в выпадающем окне, после чего отключить питание макета.
Кликнув два раза по значку        в нижнем правом углу рабочего стола
стационарного компьютера, выделить сеть Gyro и нажать кнопку
Разъединить.
      7. Подвесить макет на струну, найти положение равновесия и
закрутить макет на один оборот от положения равновесия. Убедиться по
формуле (19), что погонный угол закрутки мал. Засечь время двух пол-
ных колебаний макета, после чего рассчитать средний период колебаний
Т. Записать полученный результат.
      8. Провести повторную проверку согласно пункту 1. Включить
БК, проследить, что зажглась индикаторная лампочка подачи питания.
Подключиться к удалённому рабочему столу БК (пункт 3), запустить
программу “Gyro” и задать согласно пункту 4.3 настоящего руководства
рабочий датчик “VG-9”, порт считывания – “COM1”, усреднение,
установленное в пункте 4, квадрат среднеквадратичной ошибки для
этого усреднения      , начальный угол отклонения от положения равно-
весия – 360, измеренный период крутильных колебаний (пункт 7),
размер выборки для алгоритма уточнения ковариации шума N=0, то есть
этот алгоритм отключен.
      9. Закрутить макет ровно на один оборот от положения равновесия
против часовой стрелки. Отпустить макет, после чего нажать на кнопку
Open port ПО, начав тем самым процесс вычисления. Важно: макет не
должен сильно раскачиваться на струне и колебаться, эти движения
должны быть пренебрежимо малы по сравнению с крутильными, иначе
нельзя считать движение одномерным. Этого можно достичь, слегка
придерживая макет до начала запуска вычислений, устраняя тем самым
колебания и раскачивания.
      10. После того, как макет сделает половину или одно колебание,
нажать кнопку Close port, нажать в верху рабочего стола на кнопку ,
зайти со стационарного компьютера в Пуск-> Выполнить, открыть \\
10.10.10.4, если потребуется, ввести имя и пароль (Пункт 3), после зайти
                                  25
в папку Gyro, скопировать из этой папки файл “ххххResults .txt”, и со-
хранить в отдельную папку на стационарном компьютере, например, “1
Experiment”. Записать имя файла с результатами эксперимента, указав
параметры этого эксперимента. Файл “ххххResults .txt” из папки Gyro
удалить.
       11. Изменить в программе согласно пункту 4.3 настоящего руко-
водства размер выборки для алгоритма уточнения ковариации ошибки
на N=100. Повторить эксперимент (Пункты 8-10).
       12. Повторить эксперимент с датчиком “Mems”, установив для
него порт считывания “COM2”,         , соответствующее     усреднение,
N=100.
       13. Выключить БК (Пункт 6), снять макет со струны.
       14. Написать программу отображения графиков полученных
результатов в среде Matlab. Входным значением программы должно
быть имя файла “ххххResults .txt”, содержащего результаты эксперимен-
та, на выходе программа должна выдать 2 графика:
        График угловых скоростей, где должны отображаться записан-
ные показания датчика и выходные значения двух фильтров Калмана
для скоростей
        График угла отклонения от положения равновесия, должен со-
держать результат интегрирования кинематических уравнений и выход-
ные значения фильтров для углов.
        Пример отчета по лабораторной работе представлен в Приложе-
нии.




                                 26
                      6. Контрольные вопросы
      1. При каких предположениях относительно шума измерений и
шума системы строится теория фильтра Калмана?
      2. Чем отличается априори оценка вектора состояния     и апо-
стериори       ? Каков принцип построения этих оценок?
      3. В каком случае фильтр Калмана применим для нелинейных си-
стем? Как в этом случае определяется матрица чувствительности H и
матрица F?
      4. Опишите один цикл работы фильтра Калмана.
      5. Для математического маятника, уравнение движения которого
имеет вид                   , а модельное уравнение измерений:

               , запишите матрицы F и Н
      6. Объясните, для чего нужен алгоритм “Уточнение ковариаций”?
      7. Расскажите принцип работы волоконно-оптического гироскопа
VG-910D и микромеханического гироскопа ADIS16100.
      8. Расскажите о недостатках датчиков угловой скорости. Какие
способы их устранения вы знаете?
      9. Зависит ли ошибка измерений от усреднения и почему?




                               27
                             7. Приложение
      1. Пример отчета по лабораторной работе
                           Лабораторная работа
           Использование фильтра Калмана в задаче определения
              ориентации тела, подвешенного на струне
       Цель работы: получить навык работы с лабораторным оборудо-
ванием; получить оценку вектора состояния тела подвешенного на стру-
не с помощью зашумлённых данных датчика угловой скорости, исполь-
зуя фильтр Калмана; провести сравнительный анализ двух фильтров
Калмана, основанных на различных моделях движения.
       Лабораторное оборудование: макет твёрдого тела, подвешенный
на струне, секундомер.
                                Ход работы
       1. Оценка среднеквадратичного отклонения
               Датчик           Усреднение     , градусы
              VG-910D               15            0,0004
                                    25            0.0001
             ADIS-16100             70            0,0016
      2. Измерение периода колебаний макета
                                 T=480c.
      3. Результаты экспериментов
          Имя файла           Датчик      Усреднение    N
          23423Results.txt    VG-910D         15        0
          23873Results.txt    VG-910D         25       100
          29898Results.txt    ADIS16100       70       150

       4. Представление графиков результатов экспериментов выполне-
но в среде MatLab.

      Лабораторную работу выполнили:
      Иванов Д. С. 432 группа
      Петров А. А. 672 группа
      Крылов Д. А. 431 группа




                                  28
      2. Пример представления результатов эксперимента.




      3. Описание функций среды MATLAB, необходимых для
написания программы отображения результатов эксперимента.
    S = load('Results.txt') – функция чтения из файла, возвращает
       матрицу S значений, прочитанных из файла.
    subplot(m,n,k) – задание матрицы графиков размером mxn,
                      -номер активного графика, отсчитывается слева
       направо сверху вниз.
    plot(T,X,'k') – построение графика зависимости X(T), где X, T
       являются векторами одинакового размера. Параметр 'k' задает
       цвет графика.
    hold on – команда, сохраняющая предыдущий график при по-
       строении нового графика в этих же осях.
    title('Title') – подпись графика.
    ylabel('X'), xlabel('T') – подпись осей.
    legend('A','B','C',1) – создание легенды, последний параметр за-
       дает положение легенды относительно графика.




                                29
                     8. Список литературы
       1. А.А. Дегтярёв, Ш. Тайль. Элементы теории адаптивного расши-
ренного фильтра Калмана / Препринт ИПМ им. М.В. Келдыша РАН. –
М., 2003. – №26. – 35 с.
(http://www.keldysh.ru/papers/2003/prep26/prep2003_26.pdf)
       2. А.Д. Гладун. Лабораторный практикум по общей физике/М.:
МФТИ, 2004. – 316 с.
       3. Д.С. Иванов, М.Ю. Овчинников, Использование одноосного ги-
роскопа для определения ориентации макета в лабораторных условиях/
Препринт ИПМ им. М.В. Келдыша РАН. – М., 2008. – № 11. – 32 с.
(http://www.keldysh.ru/papers/2008/source/prep2008_11.doc)
       4. http://www.fizoptika.ru
       5. http://www.mems.ru/




                                30
